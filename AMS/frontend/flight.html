<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airline Management System</title>
</head>
<body>
    <h1>Airline Management System</h1>
    
    <!-- Add Flight Form -->
    <div>
        <h2>Add a Flight</h2>
        <form id="flightForm">
            <label>Model: <input type="text" id="model"></label><br>
            <label>Capacity: <input type="number" id="capacity"></label><br>
            <label>Source: <input type="text" id="source"></label><br>
            <label>Destination: <input type="text" id="destination"></label><br>
            <label>Ticket Cost: <input type="number" id="ticketCost"></label><br>
            <label>Status: <input type="text" id="status"></label><br>
            <label>Arrival: <input type="text" id="arrival"></label><br>
            <label>Departure: <input type="text" id="departure"></label><br>
            <button type="submit">Add Flight</button>
        </form>
    </div>

    <!-- List of Flights -->
    <div>
        <h2>All Flights</h2>
        <ul id="flightsList"></ul>
    </div>

    <script>
        const apiUrl = "http://localhost:5000";
    
        // Improved fetchFlights function with error handling
        async function fetchFlights() {
            try {
                const response = await fetch(`${apiUrl}/flights`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const flights = await response.json();
                const flightsList = document.getElementById('flightsList');
                flightsList.innerHTML = '';
                flights.forEach(flight => {
                    const li = document.createElement('li');
                    li.textContent = `Flight ${flight.Flight_ID}: ${flight.Model} - ${flight.Source} to ${flight.Destination} (${flight.Status})`;
                    flightsList.appendChild(li);
                });
            } catch (error) {
                console.error('Error fetching flights:', error);
                alert('Failed to fetch flights. Please check the console for details.');
            }
        }
    
        // Improved form submission handling
        document.getElementById('flightForm').addEventListener('submit', async (event) => {
            event.preventDefault();
    
            const flightData = {
                Model: document.getElementById('model').value,
                Capacity: parseInt(document.getElementById('capacity').value),
                Source: document.getElementById('source').value,
                Destination: document.getElementById('destination').value,
                Ticket_Cost: parseFloat(document.getElementById('ticketCost').value),
                Status: document.getElementById('status').value,
                Arrival: document.getElementById('arrival').value,
                Departure: document.getElementById('departure').value
            };
    
            try {
                const response = await fetch(`${apiUrl}/flights`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(flightData)
                });
    
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }
    
                const result = await response.json();
                alert('Flight added successfully!');
                document.getElementById('flightForm').reset();
                fetchFlights();
                fetchTotalFlights();
            } catch (error) {
                console.error('Error adding flight:', error);
                alert('Failed to add flight. Please check the console for details.');
            }
        });
    
    
        // Initial data load
        fetchFlights();
    </script>
</body>
</html>
